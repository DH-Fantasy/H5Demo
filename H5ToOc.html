
<!DOCTYPE html>

<head>
	<title>JS交互OC</title>
	<meta charset="utf-8">
</head>

<!--   CSS语法-->
<style type='text/css'>
	img{
		cursor:pointer;
	}
	#qianduanwz{ width: 100%; height: 100%; text-align: center; background: 
    url("./images/bg.png") no-repeat center;}
  #qianduanwz img{ width: 20%; padding-top: 10;}
  #qianduanwz p{ margin: 0; padding-top: 10; font-size: 20px; color: #A42D00;}
</style>

<body>
	<div id="qianduanwz">
	  <img src="./images/qrcode.png" alt="">
	  <p>测试文字<br>测试文字</p>
	</div>


	<p style="text-align:center"> <button id="btn1" type = "button" onclick = "goHomeFun()" > 再去逛逛  </button> </p>

	<p style="text-align:center"> <button id="btn2" type = "button" onclick = "shareFun()"> 要求好友助力 </button> </p>

	<p style="text-align:center"> <button id="btn2" type = "button" onclick = "testAction()"> 获取当前类型  </button> </p>

	<p style="text-align:center"> <button id="btn2" type = "button" onclick = "openAction()"> 打开App  </button> </p>

	<p style="text-align:center"> <button id="btn2" type = "button" onclick = "screenshots()"> 截图  </button> </p>

	<script src="./scripts/html2canvas.js"></script>

	<!--        JS语法-->
	<script type = "text/javascript">

		

		let type = -1;

		window.onload = function(){
			type = this.getEnvironmentType();
			var script = document.createElement('meta');
			script.name = 'viewport';
			script.content= 'width=device-width';
			document.getElementsByTagName('head')[0].appendChild(script);
		}

		function goHomeFun()
		{
			switch (type){
				case 1 : {
					window.webkit.messageHandlers.homePage.postMessage({});
				}
				break;
				case 2 : {
					alert('食九Android');
				}
				break;
				case 3 : {
					alert('微信');
				}
				break;
				case -1 : {
					alert('未知');
				}
			}
			
		}

		function shareFun()
		{
			switch (type){
				case 1 : {
					window.webkit.messageHandlers.share.postMessage({"title":"分享的标题","desc":"分享的描述","thumUrl":"http://static.haoshua.net/af4fc9b1-d3d5-4b77-7b02-dcf7136ca352-31.png","url":"https://as-vip.missfresh.cn/frontend/h5-1-castor-v1-activity/order-cash.html?masterId=85690053"});
				}
				break;
				case 2 : {
					alert('食九Android');
				}
				break;
				case 3 : {
					alert('微信');
				}
				break;
				case -1 : {
					alert('未知');
				}
			}
		}

		function getEnvironmentType() {

			let ua = window.navigator.userAgent.toLowerCase();

			if(ua.indexOf('shijiuforios') > -1){
				// alert('食九iOS')
				return 1;
			}else if(ua.indexOf('shijiuforandroid') > -1){
				// alert('食九Android')
				return 2;
			}else if(ua.indexOf('micromessenger') > -1){
				// alert("微信");
				return 3;
			}else{
				// alert('未知')
				return -1;
			}
		}

		function openAction(){
			let link = "haoshua://com.shijiu.www",
			fallback = "itms-apps://itunes.apple.com/cn/app/" + 1492856061;
// 尝试呼起 App
location.href = link;
// 3s 后未能呼起则跳转 App Store
setTimeout(() => location.href = fallback, 3000);
}

function testAction(){
    	// var obj = {"name":"xiao","age":12};
    	// alert(obj.name);
    	switch (type){
    		case 1 : {
    			alert('食九iOS');
    		}
    		break;
    		case 2 : {
    			alert('食九Android');
    		}
    		break;
    		case 3 : {
    			alert('微信');
    		}
    		break;
    		case -1 : {
    			alert('未知');
    		}
    	}
    }

    function screenshots(){
    	new html2canvas(document.getElementById('qianduanwz'), {
			  allowTaint: true,
			  useCORS: true 
			}).then(canvas => {
		    // canvas为转换后的Canvas对象
		    let oImg = new Image();
		    oImg.src = canvas.toDataURL();  // 导出图片
		    document.body.appendChild(oImg);  // 将生成的图片添加到body
			});
    	}
    
</script>

</body>

</html>
