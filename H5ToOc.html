<!DOCTYPE html>

<head>
	<title>JS交互OC</title>
	<meta charset="utf-8">
</head>

<body>

	<a href="sinaweibo://wbdiversion?username=gh_368d266558ad&path=pages%2ffind%2ffind">从微博打开小程序</a>

	<p style="text-align:center"> <button onclick="login()"> login </button> </p>

	<p style="text-align:center"> <button onclick="share()"> share </button> </p>

	<p style="text-align:center"> <button onclick="homePage()"> homePage </button> </p>

	<p style="text-align:center"> <button onclick="paySuccess()"> paySuccess </button> </p>

	<p style="text-align:center"> <button onclick="buyEatCard()"> buyEatCard </button> </p>

	<p style="text-align:center"> <button onclick="merchantDetail()"> merchantDetail </button> </p>

	<p style="text-align:center"> <button onclick="openApp()"> 打开App </button> </p>

	<p style="text-align:center"> <button onclick="testEmptyFun()"> 测试函数为空 </button> </p>

	<p style="text-align:center"> <button onclick="testAlert()"> 测试Alert </button> </p>

	<p style="text-align:center"> <button onclick="testConfirm()"> 测试Confirm </button> </p>

	<p style="text-align:center"> <button onclick="testInput()"> 测试Input </button> </p>

	<!--        JS语法-->
	<script type="text/javascript">

		let type = -1;

		window.onload = function () {
			type = this.getEnvironmentType();
		}

		function login() {
			switch (type) {
				case 1: {
					window.webkit.messageHandlers.login.postMessage({});
				}
					break;
				case 2: {
					window.Android.login();
				}
					break;
				case 3: {
					alert('微信');
				}
					break;
				case -1: {
					alert('未知');
				}
			}
		}

		function share() {
			switch (type) {
				case 1: {
					window.webkit.messageHandlers.share.postMessage({ "title": "分享的标题", "desc": "分享的描述", "thumUrl": "https://cs.api.19taste.com/Temp/share/share.jpg", "url": "http://h5.19taste.com/#/?order_number=20200427221477175460" });
				}
					break;
				case 2: {
					window.Android.share({ "title": "分享的标题", "desc": "分享的描述", "thumUrl": "http://static.haoshua.net/af4fc9b1-d3d5-4b77-7b02-dcf7136ca352-31.png", "url": "https://as-vip.missfresh.cn/frontend/h5-1-castor-v1-activity/order-cash.html?masterId=85690053" });
				}
					break;
				case 3: {
					alert('微信');
				}
					break;
				case -1: {
					alert('未知');
				}
			}
		}

		function homePage() {
			switch (type) {
				case 1: {
					window.webkit.messageHandlers.homePage.postMessage({});
				}
					break;
				case 2: {
					window.Android.homePage();
				}
					break;
				case 3: {
					alert('微信');
				}
					break;
				case -1: {
					alert('未知');
				}
			}
		}

		function paySuccess() {
			switch (type) {
				case 1: {
					window.webkit.messageHandlers.paySuccess.postMessage({ "type": 1 });
				}
					break;
				case 2: {
					window.Android.paySuccess({ "type": 1 });
				}
					break;
				case 3: {
					alert('微信');
				}
					break;
				case -1: {
					alert('未知');
				}
			}
		}

		function buyEatCard() {
			switch (type) {
				case 1: {
					window.webkit.messageHandlers.buyEatCard.postMessage({ "eatcard_id": 3 });
				}
					break;
				case 2: {
					window.Android.buyEatCard({ "eatcard_id": 3 });
				}
					break;
				case 3: {
					alert('微信');
				}
					break;
				case -1: {
					alert('未知');
				}
			}
		}

		function merchantDetail() {
			switch (type) {
				case 1: {
					window.webkit.messageHandlers.merchantDetail.postMessage({ "shop_user_id": 2 });
				}
					break;
				case 2: {
					window.Android.merchantDetail({ "shop_user_id": 2 });
				}
					break;
				case 3: {
					alert('微信');
				}
					break;
				case -1: {
					alert('未知');
				}
			}
		}


		function getEnvironmentType() {
			if (window.webkit != undefined) {
				// alert('iOS Web')
			} else if (window.Android) {
				// alert('Android Web')
			} else {
				// alert('common Web')
			}

			let ua = window.navigator.userAgent.toLowerCase();

			if (ua.indexOf('shijiuforios') > -1) {
				// alert('食九iOS')
				return 1;
			} else if (ua.indexOf('shijiuforandroid') > -1) {
				// alert('食九Android')
				return 2;
			} else if (ua.indexOf('micromessenger') > -1) {
				// alert("微信");
				return 3;
			} else {
				// alert('未知')
				return -1;
			}
		}

		function openApp() {
			let link = "haoshua://com.shijiu.www",
				fallback = "itms-apps://itunes.apple.com/cn/app/" + 1492856061;
			// 尝试呼起 App
			location.href = link;
			// 3s 后未能呼起则跳转 App Store
			setTimeout(() => location.href = fallback, 3000);
		}

		function testEmptyFun() {
			window.webkit.messageHandlers.testEmptyFun.postMessage({ "shop_user_id": 2 });
		}

		function testAlert() {
			alert()
		}

		function testConfirm() {
			var result = confirm("message");
			if (result == true) {
				alert("true");
			} else {
				alert("flase");
			}
		}

		function testInput() {
			var result = prompt("message", "嘿哈！");
			if (result != null && result != "") {
				alert(result);
			}
		}
	</script>
	
	<script type="text/javascript" src="https://xhywssz.oss-cn-beijing.aliyuncs.com/chatInit.js?accessId=sftkf&autoShow=true&isDebug=true&localdomain=true" async="async"></script>
</body>

</html>
